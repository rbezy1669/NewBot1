<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–≠–Ω–µ—Ä–≥–æ—Å–±—ã—Ç</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    :root {
      --tg-theme-bg-color: white;
      --tg-theme-text-color: black;
    }
    body {
      background-color: var(--tg-theme-bg-color);
      color: var(--tg-theme-text-color);
    }
    .glass {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }
    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.6s ease-out forwards;
    }
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start px-4 pt-6">
  <div class="text-center mb-6 fade-in">
    <h1 class="text-2xl font-bold">‚ö° –≠–Ω–µ—Ä–≥–æ—Å–±—ã—Ç</h1>
    <p class="text-gray-500">–í–∞—à –ª–∏—á–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —É—á—ë—Ç—É —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏</p>
  </div>

  <div id="userName" class="text-xl font-semibold mb-4 fade-in"></div>

  <div class="w-full max-w-md space-y-4">
    <!-- –ü–µ—Ä–µ–¥–∞—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∏—è -->
    <div class="glass p-4 transition fade-in">
      <h2 class="text-lg font-semibold mb-2">üìä –ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ–∫–∞–∑–∞–Ω–∏–π</h2>
      <form id="readingsForm" class="flex flex-col space-y-2">
        <input id="currentReading" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è..." class="p-2 rounded border focus:outline-none">
        <button type="submit" class="bg-blue-600 text-white p-2 rounded hover:bg-blue-700">–ü–µ—Ä–µ–¥–∞—Ç—å</button>
      </form>
    </div>

    <!-- –ò—Å—Ç–æ—Ä–∏—è -->
    <div class="glass p-4 transition fade-in">
      <h2 class="text-lg font-semibold mb-2">üìà –ò—Å—Ç–æ—Ä–∏—è</h2>
      <div id="historyList" class="text-sm text-white">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...</div>
      </div>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫ -->
    <div class="glass p-4 transition fade-in">
      <h2 class="text-lg font-semibold mb-2">üìâ –ì—Ä–∞—Ñ–∏–∫ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è</h2>
      <canvas id="readingChart" height="200"></canvas>
    </div>

    <!-- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ -->
    <div class="glass p-4 transition fade-in">
      <h2 class="text-lg font-semibold mb-2">üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
      <div class="flex flex-col space-y-2">
        <button onclick="openChat()" class="bg-green-600 text-white p-2 rounded hover:bg-green-700">üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ —á–∞—Ç</button>
        <button onclick="sendSupportRequest()" class="bg-gray-700 text-white p-2 rounded hover:bg-gray-800">üìÆ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–µ</button>
      </div>
    </div>
  </div>

  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
  <div id="notification" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 hidden bg-black text-white px-4 py-2 rounded-xl"></div>

  <script src="script.js"></script>
  <script>
    function drawChart(readings) {
      const labels = readings.map(r => new Date(r.date).toLocaleDateString("ru-RU"));
      const data = readings.map(r => r.value);
      const ctx = document.getElementById('readingChart').getContext('2d');

      new Chart(ctx, {
  type: 'line',
  data: {
    labels: labels,
    datasets: [{
      label: '–∫–í—Ç¬∑—á',
      data: data,
      borderColor: '#2563eb',
      backgroundColor: 'rgba(37, 99, 235, 0.2)',
      tension: 0.3,
      fill: true
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: {
        labels: {
          color: '#ffffff'
        }
      }
    },
    scales: {
      x: {
        ticks: { color: '#ffffff' },
        grid: { color: 'rgba(255,255,255,0.1)' }
      },
      y: {
        ticks: { color: '#ffffff' },
        grid: { color: 'rgba(255,255,255,0.1)' }
      }
    }
  }
});


    // –ó–∞–≥—Ä—É–∑–∏ –≥—Ä–∞—Ñ–∏–∫ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã readings –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω)
    const originalDisplayReadingsHistory = window.displayReadingsHistory;
    window.displayReadingsHistory = function(readings) {
      originalDisplayReadingsHistory(readings);
      drawChart(readings);
    };
  </script>
</body>
</html>
